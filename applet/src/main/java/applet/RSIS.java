package applet;
import java.util.Arrays;
import java.util.Random;

public class RSIS {
    public static short M = 2560;
    public static short[] A = {140, 42, 201, 185, 54, 166, 64, 83, 111, 25, 121, 1, 165, 215, 4, 160, 94, 236, 18, 193, 43, 243, 74, 155, 167, 116, 128, 110, 176, 210, 16, 219, 210, 169, 37, 153, 123, 197, 4, 116, 108, 238, 2, 69, 206, 81, 249, 57, 165, 244, 51, 220, 66, 39, 185, 137, 193, 55, 96, 163, 99, 163, 229, 86, 41, 152, 52, 246, 23, 249, 108, 151, 92, 130, 215, 179, 211, 197, 60, 30, 49, 30, 4, 95, 59, 104, 128, 248, 90, 195, 139, 226, 4, 83, 116, 56, 72, 101, 58, 152, 5, 93, 196, 243, 98, 104, 147, 112, 59, 157, 148, 212, 232, 9, 112, 78, 171, 152, 182, 74, 197, 151, 74, 240, 39, 138, 182, 89, 119, 205, 13, 36, 233, 27, 128, 26, 82, 37, 51, 256, 101, 245, 169, 91, 243, 45, 120, 214, 247, 221, 130, 167, 50, 254, 218, 148, 247, 18, 143, 10, 256, 21, 155, 157, 167, 82, 17, 221, 156, 143, 28, 40, 123, 150, 253, 24, 108, 233, 17, 76, 144, 65, 149, 81, 255, 92, 153, 86, 228, 152, 133, 72, 93, 104, 93, 218, 249, 128, 179, 154, 101, 185, 54, 39, 161, 43, 213, 131, 216, 16, 176, 6, 72, 39, 65, 48, 71, 225, 64, 148, 105, 164, 20, 43, 249, 244, 77, 205, 186, 67, 119, 38, 204, 58, 71, 79, 147, 98, 189, 130, 76, 231, 14, 47, 184, 196, 207, 212, 183, 221, 6, 67, 223, 104, 19, 130, 79, 197, 79, 44, 62, 183, 222, 37, 111, 133, 7, 81, 24, 214, 86, 27, 224, 224, 98, 3, 206, 46, 42, 216, 53, 61, 58, 162, 93, 139, 57, 255, 131, 221, 232, 121, 92, 97, 21, 16, 13, 69, 45, 93, 134, 237, 16, 243, 233, 78, 202, 101, 174, 114, 92, 234, 143, 82, 4, 244, 75, 6, 92, 38, 113, 67, 7, 59, 226, 54, 10, 49, 22, 117, 32, 34, 46, 43, 94, 78, 5, 173, 238, 164, 48, 59, 247, 99, 178, 146, 243, 21, 194, 29, 47, 27, 184, 252, 126, 164, 84, 253, 138, 245, 145, 234, 244, 255, 89, 65, 105, 165, 80, 248, 184, 157, 184, 33, 80, 28, 6, 255, 11, 135, 88, 188, 207, 86, 48, 102, 133, 10, 125, 99, 84, 101, 195, 150, 86, 208, 182, 23, 205, 189, 41, 201, 54, 95, 57, 130, 206, 70, 200, 91, 222, 128, 44, 2, 251, 75, 60, 173, 104, 6, 77, 212, 89, 159, 53, 120, 224, 49, 238, 248, 16, 136, 244, 61, 73, 240, 46, 90, 161, 74, 6, 166, 195, 42, 164, 173, 18, 235, 170, 100, 59, 255, 159, 246, 21, 55, 199, 248, 75, 226, 72, 245, 8, 159, 198, 151, 75, 239, 43, 58, 80, 215, 0, 222, 187, 163, 10, 132, 48, 138, 233, 125, 233, 179, 1, 28, 66, 244, 8, 194, 136, 4, 44, 254, 79, 6, 54, 59, 83, 173, 114, 226, 146, 22, 42, 81, 254, 120, 170, 56, 183, 126, 12, 133, 174, 86, 217, 31, 146, 31, 221, 238, 154, 169, 137, 89, 99, 128, 82, 137, 163, 91, 118, 41, 143, 212, 221, 161, 190, 171, 104, 135, 25, 61, 95, 244, 62, 161, 83, 110, 56, 174, 26, 98, 210, 123, 236, 142, 82, 37, 16, 153, 86, 93, 28, 111, 71, 124, 168, 204, 234, 97, 117, 159, 110, 49, 148, 227, 167, 165, 182, 253, 169, 248, 237, 77, 242, 150, 71, 37, 170, 91, 240, 126, 109, 240, 236, 113, 60, 254, 191, 51, 31, 4, 111, 53, 97, 118, 139, 106, 117, 71, 6, 152, 214, 64, 216, 227, 77, 171, 3, 151, 202, 222, 44, 57, 106, 68, 191, 193, 1, 135, 206, 222, 159, 4, 81, 249, 127, 216, 128, 229, 215, 145, 110, 8, 188, 67, 212, 195, 168, 187, 237, 234, 141, 127, 169, 82, 173, 68, 81, 68, 86, 142, 177, 226, 197, 89, 134, 143, 21, 38, 164, 128, 79, 151, 38, 98, 37, 90, 243, 182, 249, 209, 22, 52, 86, 147, 187, 2, 255, 196, 70, 123, 172, 47, 120, 88, 146, 118, 157, 90, 233, 181, 105, 180, 76, 150, 28, 212, 141, 5, 68, 135, 233, 62, 14, 148, 68, 127, 10, 219, 85, 208, 71, 244, 52, 5, 239, 241, 191, 226, 15, 82, 95, 208, 31, 79, 69, 166, 15, 80, 206, 1, 174, 220, 66, 254, 130, 159, 185, 151, 123, 230, 170, 159, 84, 44, 118, 153, 127, 17, 230, 66, 225, 6, 30, 173, 95, 31, 117, 23, 220, 200, 175, 254, 188, 111, 208, 195, 142, 44, 175, 42, 16, 46, 75, 51, 127, 92, 50, 177, 211, 1, 192, 119, 41, 103, 79, 18, 33, 122, 147, 225, 63, 69, 186, 208, 203, 96, 23, 136, 122, 33, 5, 174, 147, 78, 3, 85, 154, 61, 115, 231, 49, 243, 97, 21, 232, 144, 116, 21, 114, 92, 223, 255, 186, 166, 126, 144, 112, 166, 97, 95, 210, 17, 116, 198, 223, 237, 78, 202, 10, 106, 252, 22, 151, 134, 13, 220, 142, 239, 114, 39, 226, 185, 180, 162, 203, 222, 22, 193, 95, 201, 105, 76, 114, 90, 185, 117, 30, 226, 101, 153, 197, 109, 210, 50, 206, 92, 217, 226, 78, 248, 253, 25, 41, 5, 181, 206, 242, 174, 156, 246, 67, 170, 66, 81, 79, 141, 65, 159, 239, 57, 88, 121, 234, 201, 13, 139, 193, 149, 51, 46, 209, 198, 221, 249, 128, 255, 64, 187, 137, 203, 104, 134, 191, 85, 174, 76, 184, 82, 163, 85, 80, 184, 68, 242, 249, 245, 220, 60, 180, 40, 202, 56, 246, 183, 162, 22, 41, 244, 32, 169, 162, 74, 244, 104, 158, 94, 65, 244, 21, 55, 253, 193, 1, 108, 21, 67, 11, 47, 239, 103, 10, 30, 36, 182, 25, 243, 122, 79, 193, 116, 149, 23, 71, 103, 173, 154, 148, 194, 188, 167, 21, 178, 63, 184, 147, 117, 2, 87, 71, 86, 147, 140, 47, 240, 254, 0, 136, 246, 87, 78, 0, 222, 3, 190, 84, 104, 59, 114, 0, 57, 179, 24, 228, 52, 76, 60, 205, 53, 38, 152, 87, 77, 38, 33, 255, 157, 138, 243, 82, 223, 209, 172, 177, 97, 45, 118, 203, 145, 145, 189, 232, 32, 17, 208, 45, 190, 251, 227, 65, 255, 240, 19, 183, 119, 160, 178, 84, 10, 59, 177, 10, 70, 52, 111, 29, 21, 0, 87, 165, 44, 176, 157, 11, 169, 256, 67, 134, 171, 40, 187, 244, 54, 172, 105, 116, 147, 117, 59, 10, 246, 190, 9, 134, 121, 137, 93, 130, 137, 241, 12, 93, 236, 179, 138, 139, 54, 27, 242, 17, 178, 175, 60, 77, 40, 162, 37, 140, 87, 42, 131, 182, 134, 243, 69, 58, 242, 118, 132, 146, 57, 1, 65, 106, 13, 99, 193, 139, 53, 98, 33, 120, 130, 226, 56, 250, 87, 142, 72, 21, 22, 234, 103, 143, 67, 79, 253, 200, 53, 116, 67, 222, 4, 234, 198, 208, 74, 233, 231, 135, 8, 225, 26, 254, 9, 95, 105, 196, 238, 177, 19, 212, 171, 14, 20, 126, 142, 85, 53, 102, 36, 202, 75, 9, 146, 74, 48, 237, 240, 0, 75, 109, 247, 123, 148, 177, 75, 91, 194, 112, 5, 207, 120, 39, 246, 110, 178, 148, 10, 218, 105, 192, 121, 34, 27, 146, 123, 246, 250, 81, 42, 161, 21, 232, 168, 188, 206, 108, 102, 235, 217, 119, 220, 255, 211, 256, 103, 179, 180, 195, 61, 64, 17, 55, 16, 74, 47, 60, 232, 90, 210, 107, 233, 44, 67, 0, 135, 219, 136, 92, 11, 231, 70, 211, 29, 28, 246, 122, 14, 82, 193, 99, 21, 115, 118, 28, 49, 251, 229, 139, 226, 27, 198, 153, 230, 59, 29, 221, 108, 105, 63, 167, 190, 53, 70, 128, 203, 123, 219, 239, 136, 126, 190, 165, 145, 50, 38, 214, 86, 94, 21, 171, 47, 165, 250, 34, 149, 24, 85, 233, 199, 10, 14, 116, 194, 168, 19, 46, 245, 59, 31, 124, 193, 96, 155, 198, 218, 228, 52, 106, 187, 126, 9, 19, 114, 13, 204, 253, 164, 88, 85, 102, 146, 106, 89, 116, 165, 108, 146, 239, 141, 18, 11, 208, 77, 46, 14, 33, 19, 90, 4, 143, 19, 227, 207, 130, 138, 80, 208, 138, 28, 60, 213, 123, 131, 42, 72, 164, 39, 2, 132, 57, 29, 2, 155, 211, 197, 193, 111, 60, 9, 40, 116, 37, 138, 53, 3, 167, 117, 88, 109, 18, 6, 93, 217, 85, 40, 28, 30, 51, 132, 13, 29, 6, 30, 10, 157, 226, 46, 125, 214, 144, 121, 12, 149, 101, 114, 254, 140, 24, 188, 171, 56, 195, 252, 170, 254, 70, 55, 128, 254, 107, 239, 63, 130, 21, 133, 134, 48, 48, 137, 162, 49, 94, 84, 84, 118, 207, 220, 239, 33, 252, 230, 170, 208, 60, 201, 147, 83, 62, 238, 234, 4, 162, 187, 110, 163, 37, 9, 61, 114, 43, 250, 179, 41, 210, 234, 180, 143, 91, 141, 237, 185, 98, 89, 236, 49, 181, 129, 142, 183, 207, 256, 2, 181, 107, 164, 145, 170, 136, 108, 162, 112, 60, 181, 6, 173, 167, 175, 247, 14, 66, 244, 168, 51, 226, 140, 5, 184, 29, 246, 192, 112, 145, 151, 112, 106, 141, 89, 64, 148, 244, 24, 221, 158, 240, 89, 157, 183, 21, 9, 134, 238, 3, 64, 175, 198, 121, 44, 74, 5, 1, 146, 114, 83, 162, 72, 173, 117, 248, 240, 105, 103, 179, 14, 254, 47, 215, 218, 237, 93, 161, 44, 128, 207, 18, 110, 21, 148, 99, 176, 110, 208, 191, 169, 139, 33, 114, 72, 50, 142, 26, 35, 81, 186, 237, 82, 250, 13, 234, 136, 73, 23, 16, 175, 244, 79, 140, 219, 215, 183, 33, 248, 32, 252, 89, 244, 71, 94, 74, 167, 162, 72, 149, 146, 211, 136, 112, 211, 177, 68, 242, 12, 142, 25, 15, 250, 34, 4, 194, 113, 239, 74, 79, 18, 143, 73, 104, 211, 13, 166, 149, 25, 183, 3, 62, 201, 138, 245, 243, 95, 1, 245, 42, 189, 66, 146, 142, 227, 80, 107, 64, 71, 162, 66, 39, 205, 12, 243, 206, 99, 61, 244, 128, 185, 27, 220, 52, 226, 129, 85, 12, 33, 37, 93, 12, 140, 81, 197, 5, 230, 88, 227, 54, 50, 11, 154, 84, 96, 17, 182, 216, 84, 156, 31, 147, 249, 230, 181, 229, 227, 170, 75, 47, 185, 29, 5, 80, 246, 39, 96, 39, 153, 201, 120, 8, 117, 57, 3, 16, 159, 115, 216, 153, 81, 17, 197, 170, 19, 197, 29, 131, 30, 101, 31, 238, 139, 192, 46, 170, 40, 70, 145, 93, 42, 91, 187, 52, 242, 134, 72, 173, 230, 30, 92, 31, 167, 136, 18, 189, 41, 225, 178, 137, 186, 135, 22, 120, 155, 13, 140, 199, 141, 247, 212, 111, 188, 217, 172, 90, 10, 115, 250, 220, 72, 114, 152, 51, 20, 131, 209, 43, 122, 217, 6, 117, 174, 172, 37, 5, 116, 175, 252, 174, 85, 40, 90, 192, 98, 109, 245, 141, 185, 91, 161, 113, 1, 206, 117, 198, 86, 115, 128, 136, 31, 104, 234, 169, 10, 67, 144, 191, 120, 210, 246, 94, 140, 231, 38, 198, 38, 122, 228, 105, 81, 1, 203, 146, 178, 39, 23, 38, 29, 196, 71, 43, 1, 82, 204, 243, 133, 189, 205, 9, 31, 189, 112, 241, 129, 86, 84, 110, 202, 25, 175, 43, 91, 84, 110, 40, 190, 51, 31, 96, 23, 220, 21, 215, 252, 248, 116, 156, 190, 151, 233, 107, 139, 144, 182, 158, 106, 30, 158, 217, 147, 34, 79, 153, 150, 251, 77, 113, 185, 37, 31, 88, 147, 10, 213, 248, 38, 52, 148, 42, 201, 87, 90, 17, 45, 201, 166, 13, 29, 74, 123, 141, 247, 59, 85, 114, 79, 149, 2, 126, 57, 195, 36, 104, 107, 109, 152, 87, 122, 156, 251, 150, 73, 98, 17, 213, 9, 18, 88, 187, 126, 135, 148, 216, 198, 196, 75, 15, 131, 178, 250, 4, 166, 7, 244, 70, 89, 238, 8, 35, 169, 13, 11, 1, 156, 60, 23, 58, 117, 2, 186, 85, 241, 188, 136, 103, 139, 164, 249, 218, 134, 120, 178, 115, 114, 18, 135, 132, 159, 45, 165, 205, 199, 222, 46, 198, 183, 149, 244, 81, 97, 177, 102, 123, 104, 49, 254, 32, 173, 254, 116, 66, 79, 220, 159, 232, 168, 88, 241, 190, 200, 76, 199, 60, 163, 185, 210, 160, 166, 206, 86, 118, 112, 218, 24, 143, 167, 115, 162, 157, 120, 171, 154, 91, 5, 151, 194, 146, 181, 178, 55, 99, 78, 6, 147, 173, 39, 21, 144, 15, 69, 106, 224, 135, 0, 97, 229, 153, 174, 111, 223, 83, 228, 72, 63, 30, 220, 181, 236, 91, 92, 201, 250, 224, 238, 117, 71, 52, 232, 15, 184, 173, 254, 238, 71, 189, 40, 174, 111, 87, 137, 102, 132, 172, 30, 139, 105, 140, 179, 94, 151, 6, 166, 196, 122, 101, 50, 234, 72, 123, 81, 67, 219, 90, 214, 119, 220, 26, 252, 233, 159, 29, 215, 104, 119, 98, 186, 152, 45, 92, 204, 252, 109, 220, 164, 41, 23, 95, 63, 59, 71, 170, 86, 97, 130, 58, 75, 199, 78, 244, 13, 249, 51, 22, 194, 117, 221, 21, 238, 226, 79, 8, 47, 247, 145, 69, 146, 84, 161, 204, 96, 138, 96, 214, 69, 140, 13, 68, 42, 89, 100, 211, 54, 190, 148, 152, 6, 44, 212, 200, 192, 229, 187, 41, 190, 197, 76, 110, 200, 18, 221, 250, 24, 227, 136, 86, 9, 201, 245, 139, 13, 216, 159, 200, 206, 73, 245, 92, 122, 2, 121, 78, 183, 41, 53, 251, 86, 74, 100, 165, 118, 155, 40, 37, 58, 219, 168, 23, 233, 145, 22, 160, 75, 79, 52, 186, 147, 179, 170, 51, 204, 34, 139, 240, 102, 109, 187, 224, 243, 18, 132, 134, 72, 227, 211, 78, 74, 199, 112, 150, 38, 25, 3, 145, 105, 250, 37, 44, 230, 160, 112, 88, 130, 34, 189, 134, 142, 242, 103, 80, 183, 215, 146, 254, 214, 200, 99, 3, 7, 8, 45, 178, 186, 196, 200, 166, 248, 146, 48, 20, 150, 154, 36, 146, 24, 239, 127, 0, 91, 162, 224, 172, 117, 138, 102, 59, 110, 148, 205, 60, 70, 71, 147, 246, 232, 144, 20, 90, 54, 67, 241, 236, 249, 118, 146, 221, 162, 163, 169, 247, 211, 128, 44, 222, 50, 111, 75, 207, 88, 191, 244, 188, 60, 77, 104, 54, 133, 26, 42, 9, 219, 240, 253, 36, 238, 137, 145, 41, 220, 185, 88, 172, 213, 189, 116, 54, 148, 37, 107, 84, 61, 249, 25, 240, 136, 24, 135, 100, 168, 249, 10, 158, 103, 98, 26, 220, 120, 178, 136, 204, 187, 66, 108, 153, 99, 6, 148, 84, 109, 235, 178, 93, 65, 201, 119, 131, 53, 185, 3, 66, 108, 108, 214, 141, 171, 248, 200, 245, 214, 163, 191, 3, 217, 2, 187, 234, 174, 187, 251, 92, 176, 242, 232};
    public static short L = 20; // l = m/n
    
    public static short[] hash(byte[] m) throws Exception {
        if (m.length != M/8) throw new Exception("invalid length");
        short[] encoded = new short[M];
        for (int i=0; i<M/8; i++) {
            for (int j=0; j<8; j++) {
                boolean bit = (m[i]&(1<<j))!=0;
                encoded[i*8+j] = bit ? (short)1 : 0;
            }
        }

        NTT.rsis_forward(encoded);
        short[] ret = new short[L];

        for(int i=0; i<L; i++) {
            for(int j=0; j<M/L; j++) {
                ret[i] = NTT.add_mod(ret[i], NTT.mul_mod(A[i*L+j], encoded[i], NTT.RSIS_Q), NTT.RSIS_Q);
            }
        }

        return ret;
    }

    public static short[] sampleShort(int len) {
        Random rand = new Random(); // FIXME
        short[] ret = new short[len];
        short[] trivial = new short[len];
        while(Arrays.equals(ret, trivial)) {
            for (int i = 0; i < len; i++) {
                ret[i] = (short)(Math.round(rand.nextInt(0, 2))); // FIXME
            }
        }
        //System.out.printf("%s\n", Arrays.toString(ret));
        return ret;
    }
}
