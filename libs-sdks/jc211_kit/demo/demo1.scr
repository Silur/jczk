//+
// Copyright (c) 1999 Sun Microsystems, Inc. All rights reserved.
//
// This software is the confidential and proprietary information of Sun
// Microsystems, Inc. ("Confidential Information").  You shall not
// disclose such Confidential Information and shall use it only in
// accordance with the terms of the license agreement you entered into
// with Sun.
//
// SUN MAKES NO REPRESENTATIONS OR WARRANTIES ABOUT THE SUITABILITY OF THE
// SOFTWARE, EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
// IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
// PURPOSE, OR NON-INFRINGEMENT. SUN SHALL NOT BE LIABLE FOR ANY DAMAGES
// SUFFERED BY LICENSEE AS A RESULT OF USING, MODIFYING OR DISTRIBUTING
// THIS SOFTWARE OR ITS DERIVATIVES.
//-

//+
// $Workfile: demo1.scr $
// $Revision: 7 $
// $Date: 4/25/00 4:57p $
// $Author: Ravi $
// $Archive: /Products/Europa/demo/demo1.scr $
// $Modtime: 4/25/00 4:52p $
// Original author: <your name here>
//-

/////////////////////////////////////////////////////////////////////
// This is a sample input file used by the jp.bat file.
//
// Comments lines begin with "//".
// Non-comment lines are C-APDUs represented by hex digits.
//
// Beneath each C-APDU is a comment the corresponding R-APDU expected to be returned
// by the card.
//
// Compare the expected with the actual APDUs to verify correct behavior.
/////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////
// Select all installed Applets
/////////////////////////////////////////////////////////////////////

powerup;

// Select the installer applet
0x00 0xA4 0x04 0x00 0x09 0xa0 0x00 0x00 0x00 0x62 0x03 0x01 0x08 0x01 0x7F;
// 90 00 = SW_NO_ERROR


// begin installer command
0x80 0xB0 0x00 0x00 0x00 0x7F;

// create JavaPurse
0x80 0xB8 0x00 0x00 0x0c 0x0a 0xa0 0x00 0x00 0x00 0x62 0x03 0x01 0x0c 0x2 0x01 0x00 0x7F;

// create JavaLoyalty
0x80 0xB8 0x00 0x00 0x0c 0x0a 0xa0 0x00 0x00 0x00 0x62 0x03 0x01 0x0c 0x5 0x01 0x00 0x7F;

// create wallet applet
0x80 0xB8 0x00 0x00 0x11 0x0a 0xa0 0x0 0x0 0x0 0x62 0x3 0x1 0xc 0x6 0x1 0x05 0x01 0x02 0x03 0x04 0x05 0x7F;

// end installer command
0x80 0xBA 0x00 0x00 0x00 0x7F;


/////////////////////////////////////////////////////////////////////
// Initialize JavaPurse
/////////////////////////////////////////////////////////////////////

// Select JavaPurse
0x00 0xa4 0x04 0x00 10 0xa0 0 0 0 0x62 3 1 0xc 2 1 127;
// 90 00 = SW_NO_ERROR

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F; 
//00 00 00 00 0c 1f 63 00 01 90 00 = Purse ID : 0x00000000; ExpDate 12/31/99; PUN 1
//For the second and consecutive runs it can be 69 82

// Complete Parameter Update: CAD ID 0x11223344; Set Master PIN 12345678
0x80 0x26 0x00 0x00 0x1A 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC1 0x08 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 00 00 00 00 00 00 00 00 90 00 
// For second and consecutive runs it can be 91 04

// Verify PIN : Master PIN
0x00 0x20 0x00 0x81 0x08 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x7F;
// 90 00;

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F;
// 00 00 00 00 0c 1f 63 00 02 90 00 = Purse ID : 0x00000000; ExpDate 12/31/99; PUN 2

// Complete Parameter Update: CAD ID 0x11223344; Set User PIN 1234
0x80 0x26 0x00 0x00 0x16 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC2 0x04 0x01 0x02 0x03 0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 00 00 00 00 00 00 00 00 90 00;

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F;
// 00 00 00 00 0c 1f 63 00 03 90 00 = Purse ID : 0x00000000; ExpDate 12/31/99; PUN 3

// Complete Parameter Update: CAD ID 0x11223344; Set ExpDate 12/31/98
0x80 0x26 0x00 0x00 0x15 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC5 0x03 0x0c 0x1f 0x62 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 00 00 00 00 00 00 00 00 90 00;

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F;
// 00 00 00 00 0c 1f 62 00 04 90 00 = Purse ID : 0x00000000; ExpDate 12/31/98; PUN 4

// Complete Parameter Update: CAD ID 0x11223344; Set Purse ID 0x05050505
0x80 0x26 0x00 0x00 0x16 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC6 0x04 0x05 0x05 0x05 0x05 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 00 00 00 00 00 00 00 00 90 00;

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 00 05 90 00 = Purse ID : 0x05050505; ExpDate 12/31/98; PUN 5

// Complete Parameter Update: CAD ID 0x11223344; Set Max Balance $320.00;
0x80 0x26 0x00 0x00 0x14 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC7 0x02 0x7D 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 00 00 00 00 00 00 00 00 90 00;

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 00 06 90 00 = Purse ID : 0x05050505; ExpDate 12/31/98; PUN 6

// Complete Parameter Update: CAD ID 0x11223344; Set Max Transaction $30.00;
0x80 0x26 0x00 0x00 0x14 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC8 0x02 0x0B 0xB8 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 00 00 00 00 00 00 00 00 90 00;

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 00 07 90 00 = Purse ID : 0x05050505; ExpDate 12/31/98; PUN 7

// Complete Parameter Update: CAD ID 0x11223344; Set Java Purse Version 2.1.0.1
0x80 0x26 0x00 0x00 0x16 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC9 0x04 0x02 0x01 0x00 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 00 00 00 00 00 00 00 00 90 00;

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 00 08 90 00 = Purse ID : 0x05050505; ExpDate 12/31/98; PUN 8

// Complete Parameter Update: CAD ID 0x11223344; Loyalty1 = "0xa0,00,00,00,62,03,01,07,01"
0x80 0x26 0x00 0x00 0x1D 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xCA 0x0B 0x33 0x55 0xA0 0x00 0x00 0x00 0x62 0x03 0x01 0x07 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 00 00 00 00 00 00 00 00 90 00;

//////////////////////////////////////////////////////////////////////
// End of initialization session, all values are set up.
//////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////
// Regular  transaction session	 at CAD 22446688 in the Bank
//////////////////////////////////////////////////////////////////////

// Select JavaPurse
0x00 0xa4 0x04 0x00 10 0xa0 0 0 0 0x62 3 1 0xc 2 1 127;
// 90 00 = SW_NO_ERROR

// Verify PIN (User PIN 01020304)
0x00 0x20 0x00 0x82 0x04 0x01 0x02 0x03 0x04 0x00;
// 90 00;

// Initialize Transaction: Credit $250.00 
0x80 0x20 0x01 0x00 0x0a 0x61 0xa8 0x22 0x44 0x66 0x88 0x00 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 00 00 00 01 00 00 00 00 00 00 00 00 90 00 
//= Purse ID : 0x05050505; ExpDate 12/31/98; TN=1

// Complete Transaction: Date 10/27/97; Time 15:33
0x80 0x22 0x00 0x00 0x0d 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x0a 0x1b 0x61 0x0f 0x21 0x7F;
// 61 a8 00 00 00 00 00 00 00 00 90 00	= Purse Balance $250.00;

// Initialize Transaction: Debit $25.00;
0x80 0x20 0x02 0x00 0x0a 0x09 0xc4 0x22 0x44 0x66 0x88 0x00 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 61 a8 00 02 00 00 00 00 00 00 00 00 90 00;
//= Purse ID : 0x05050505; ExpDate 12/31/98; TN=2

// Complete Transaction: Date 10/27/97; Time 15:35
0x80 0x22 0x00 0x00 0x0d 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x0a 0x1b 0x61 0x0f 0x23 0x7F;
// 57 e4 00 00 00 00 00 00 00 00 90 00	= Purse Balance $225.00;


/////////////////////////////////////////////////////////////////////
// Regular  transaction session	 at CAD 33557799 in a store
/////////////////////////////////////////////////////////////////////

// Select JavaPurse
0x00 0xa4 0x04 0x00 10 0xa0 0 0 0 0x62 3 1 0xc 2 1 127;
// 90 00 = SW_NO_ERROR

// Verify PIN (User PIN 01020304)
0x00 0x20 0x00 0x82 0x04 0x01 0x02 0x03 0x04 0x00;
// 90 00;

// Initialize Transaction: Debit $22.95
0x80 0x20 0x02 0x00 0x0a 0x08 0xf7 0x33 0x55 0x77 0x99 0x00 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 57 e4 00 03 00 00 00 00 00 00 00 00 90 00;
//= Purse ID : 0x05050505; ExpDate 12/31/98; TN=3

// Complete Transaction: Date 10/27/97; Time 17:45
0x80 0x22 0x00 0x00 0x0d 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x0a 0x1b 0x61 0x11 0x2d 0x7F;
// 4e ed 00 00 00 00 00 00 00 00 90 00	= Purse Balance $202.05


/////////////////////////////////////////////////////////////////////
// A session with various errors at CAD 33445566 
/////////////////////////////////////////////////////////////////////

// Select JavaPurse
0x00 0xa4 0x04 0x00 10 0xa0 0 0 0 0x62 3 1 0xc 2 1 127;
// 90 00 = SW_NO_ERROR

// Initialize Transaction: Debit $22.95
0x80 0x20 0x02 0x00 0x0a 0x08 0xf7 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x7F;
// 69 82 = SW "Security Status Not Satisfied" : must present PIN first

// Verify PIN (User PIN 01030507)
0x00 0x20 0x00 0x82 0x04 0x01 0x03 0x05 0x07 0x00;
// 69 c4 = SW_PIN_FAILED, 4 tries remained

// Initialize Transaction: Debit $22.95
0x80 0x20 0x02 0x00 0x0a 0x08 0xf7 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x7F;
// 69 82 = SW "Security Status Not Satisfied"

// Verify PIN (User PIN 01020304)
0x00 0x20 0x00 0x82 0x04 0x01 0x02 0x03 0x04 0x00;
// 90 00 = SW_NO_ERROR

// Complete Transaction: Date 10/28/97; Time 18:45
0x80 0x22 0x00 0x00 0x0d 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x0a 0x1c 0x61 0x12 0x2d 0x7F;
// 91 04 = SW_COMMAND_OUT_OF_SEQUENCE: Complete command should follow valid Initialize

// Initialize Transaction: Debit $22.95
0x80 0x20 0x02 0x00 0x0a 0x08 0xf7 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 4e ed 00 04 00 00 00 00 00 00 00 00 90 00  = TN = 4; Balance = $202.05

// Complete Transaction: Date 10/28/97; Time 18:48
0x80 0x22 0x00 0x00 0x0d 0x11 0x11 0x11 0x11 0x11 0x11 0x11 0x11 0x0a 0x1c 0x61 0x12 0x30 0x7F;
// 91 05 = SW_WRONG_SIGNATURE: This attempt of transaction is recorded in the log

// Complete Transaction: Date 10/28/97; Time 18:50;
0x80 0x22 0x00 0x00 0x0d 0x35 0xa9 0x3b 0x26 0x50 0x58 0x97 0x93 0x0a 0x1c 0x61 0x12 0x32 0x7F;
// 91 04 = SW_COMMAND_OUT_OF_SEQUENCE
// (Transaction with a wrong signature is in a way completed, 
// We can't retry with another signature.)

// Initialize transaction: Debit $9.86
0x80 0x20 0x02 0x00 0x0a 0x03 0xda 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 4e ed 00 05 00 00 00 00 00 00 00 00 90 00 = TN = 5; Balance = $202.05

// Complete Transaction: Date 10/28/97; Time 18:53
0x80 0x22 0x00 0x00 0x0d 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x0a 0x1c 0x61 0x12 0x35 0x7F;
// 4b 13 00 00 00 00 00 00 00 00 90 00 = Balance = $192.19

// Initialize transaction: Debit $30.01
0x80 0x20 0x02 0x00 0x0a 0x0b 0xb9 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x7F;
// 91 03 = SW_AMOUNT_TOO_HIGH (The Max Amount was set to $30.00)

// Initialize transaction: Credit $127.82
0x80 0x20 0x01 0x00 0x0a 0x31 0xee 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x7F;
// 91 01 = SW_CREDIT_TOO_HIGH (The Max Balance was set to $320.00, 
// this transaction would bring it to 320.01)


/////////////////////////////////////////////////////////////////////
// Session of reading balance and log at CAD 22446688 in the Bank
/////////////////////////////////////////////////////////////////////

// Select JavaPurse
0x00 0xa4 0x04 0x00 10 0xa0 0 0 0 0x62 3 1 0xc 2 1 127;
// 90 00 = SW_NO_ERROR

// Verify PIN (User PIN 01020304)
0x00 0x20 0x00 0x82 0x04 0x01 0x02 0x03 0x04 0x00;
// 90 00;

// Read the only record in Balances file : 
// SFI = 4 (00100), record N is specified in P1 => P2 = 00100100 = 0x24
0x00 0xb2 0x01 0x24 0x00 0x7F;
// 4b 13 7d 00 0b b8 90 00 = Balance = $192.19, Max Balance = $320.00, Max Transaction = $30;

// Read the first record in log file
// SFI = 3 (00011), record N is specified in P1 => P2 = 00011100 = 0x1c
0x00 0xb2 0x01 0x1c 0x00 0x7F;
// 00 05 02 03 da 33 44 55 66 0a 1c 61 12 35 4b 13 90 00 90 00 
// TN = 5; Transaction Type = DEBIT(02); Amount = $9.86(03da); CAD ID 33445566;
// Date 10/28/97 (0a 1c 61); Time 18:53(12 35); Balance $192.19 (4b 13), SW = NO_ERROR (9000)

// Read the second record in log file
// SFI = 3 (00011), record N is specified in P1 => P2 = 00011100 = 0x1c
0x00 0xb2 0x02 0x1c 0x00 0x7F;
// 00 04 02 08 f7 33 44 55 66 0a 1c 61 12 30 4e ed 91 05 90 00;
// TN = 4; Transaction Type = DEBIT(02); Amount = $22.95(08f7); CAD ID 33445566;
// Date 10/28/97 (0a 1c 61); Time 18:53(12 35); Balance $202.05 (4eed), SW_WRONG_SIGNATURE (9105)
// Attempt of the transaction is recorded, but balance wasn't change, see next record.

// Read the third record in log file
// SFI = 3 (00011), record N is specified in P1 => P2 = 00011100 = 0x1c
0x00 0xb2 0x03 0x1c 0x00 0x7F;
// 00 03 02 08 f7 33 55 77 99 0a 1b 61 12 2d 4e ed 90 00 90 00 
// TN = 3; Transaction Type = DEBIT(02); Amount = $22.95(08f7); CAD ID 33557799;
// Date 10/27/97 (0a 1b 61); Time 18:45(12 2d); Balance $202.05 (4eed), SW = NO_ERROR (9000)

// Read the fifth record in log file
// SFI = 3 (00011), record N is specified in P1 => P2 = 00011100 = 0x1c
0x00 0xb2 0x05 0x1c 0x00 0x7F;
// 00 01 01 61 a8 22 44 66 88 0a 1b 61 0f 21 61 a8 90 00 90 00;
// TN = 1; Transaction Type = CREDIT(01); Amount = $250.00(61a8); CAD ID 22446688;
// Date 10/27/97 (0a 1b 61); Time 15:33(0f 21); Balance $250.00 (61a8), SW = NO_ERROR (9000)

// Read the sixth record in log file
// SFI = 3 (00011), record N is specified in P1 => P2 = 00011100 = 0x1c
0x00 0xb2 0x06 0x1c 0x00 0x7F;
// 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 90 00 
// Empty record

// Read Expiration Date from Parameters file
// SFI = 2 (00010), record tag 0xc5 is in P1 => P2 = 00010000 = 0x10;
0x00 0xb2 0xc5 0x10 0x00 0x7F;
// 69 82 : SW Security status not satisfied - One has to present Master PIN to read Parameters

// Verify PIN : Master PIN
0x00 0x20 0x00 0x81 0x08 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x00;
// 90 00;

// Read Expiration Date from Parameters file
// SFI = 2 (00010), record tag 0xc5 is in P1 => P2 = 00010000 = 0x10;
0x00 0xb2 0xc5 0x10 0x00 0x7F;
// c5 03 0c 1f 62 90 00	  = Tag = 0xc5, Exp. Date = 12/31/98 (0c 1f 62)

// Select File: select EF under current DF (P1 = 0x02); FID = 0x9103
0x00 0xa4 0x02 0x0c 0x02 0x91 0x03 0x00;
// 90 00;

// Read the first record in the selected file
// currently selected file, record N is specified in P1 => P2 = 00000100 = 0x04
0x00 0xb2 0x01 0x04 0x00 0x7F;
// 00 05 02 03 da 33 44 55 66 0a 1c 61 12 35 4b 13 90 00 90 00 
// TN = 5; Transaction Type = DEBIT(02); Amount = $9.86(03da); CAD ID 33445566;
// Date 10/28/97 (0a 1c 61); Time 18:53(12 35); Balance $192.19 (4b 13), SW = NO_ERROR (9000)

/////////////////////////////////////////////////////////////
// Additional JavaPurse tests to increase coverage
/////////////////////////////////////////////////////////////

// Select JavaPurse
0x00 0xa4 0x04 0x00 10 0xa0 0 0 0 0x62 3 1 0xc 2 1 127;
// 90 00 = SW_NO_ERROR

// Verify PIN (User PIN 01020304)
0x00 0x20 0x00 0x82 0x04 0x01 0x02 0x03 0x04 0x00;
// 90 00;

// Wrong INS for Java Purse CLA
0x80 0x34 0x00 0x00 0x00 0x00;
// 6d 00;

// Wrong CLA
0x60 0x00 0x00 0x00 0x00 0x00;
// 6e 00;

// Wrong INS for ISO CLA
0x00 0x74 0x00 0x00 0x00 0x00;
// 6d 00 

// Initialize transaction: wrong transaction type
0x80 0x20 0x03 0x00 0x0a 0x0b 0xb9 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x7F;
// 6a 86 == SW_INCORRECT_P1P2

// Initialize transaction: incorrect P2
0x80 0x20 0x02 0x11 0x0a 0x0b 0xb9 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x7F;
// 6a 86 == SW_INCORRECT_P1P2

// Initialize transaction: incorrect LC
0x80 0x20 0x02 0x11 0x0b 0x0b 0xb9 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x00 0x7F;
// 67 00 == SW_WRONG_LENGTH

// Initialize transaction: Debit $9.86
0x80 0x20 0x02 0x00 0x0a 0x03 0xda 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 4b 13 00 06 00 00 00 00 00 00 00 00 90 00 = TN = 6; Balance = $192.19

// Complete Transaction: incorrect LC
0x80 0x22 0x00 0x00 0x0c 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x0a 0x1c 0x61 0x12 0x35 0x7F;
// 67 00 == SW_WRONG_LENGTH

// Complete Transaction: incorrect P1
0x80 0x22 0x11 0x00 0x0d 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x0a 0x1c 0x61 0x12 0x35 0x7F;
// 6a 86 == SW_INCORRECT_P1P2

// Complete Transaction: incorrect P2
0x80 0x22 0x00 0x11 0x0d 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x0a 0x1c 0x61 0x12 0x35 0x7F;
// 6a 86 == SW_INCORRECT_P1P2

/////////////////////////////////////////////////////////
// Additional cases for Parameter Update
/////////////////////////////////////////////////////////

// Select JavaPurse
0x00 0xa4 0x04 0x00 10 0xa0 0 0 0 0x62 3 1 0xc 2 1 127;
// 90 00 = SW_NO_ERROR

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F; 
// 69 82 = SW "Security Status Not Satisfied" : must present PIN first

// Verify PIN : Master PIN
0x00 0x20 0x00 0x86 0x08 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x00;
// 6a 86 == SW_INCORRECT_P1P2

// Verify PIN : Master PIN
0x00 0x20 0x00 0x81 0x08 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x00;
// 90 00;

// Initialize Parameter Update
0x80 0x24 0x11 0x00 0x00 0x7F; 
// 6a 86 == SW_INCORRECT_P1P2

// Initialize Parameter Update
0x80 0x24 0x00 0x11 0x00 0x7F; 
// 6a 86 == SW_INCORRECT_P1P2

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F; 
// 05 05 05 05 0c 1f 62 00 09 90 00 = Purse ID : 0x05050505; ExpDate 12/31/98; PUN 9 

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F;
// 91 04 = SW_COMMAND_OUT_OF_SEQUENCE

// Complete Parameter Update: CAD ID 0x11223344; Set ExpDate 12/31/98
0x80 0x26 0x11 0x00 0x15 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC5 0x03 0x0c 0x1f 0x62 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 6a 86 == SW_INCORRECT_P1P2

// Complete Parameter Update: CAD ID 0x11223344; Set ExpDate 12/31/98
0x80 0x26 0x00 0x11 0x15 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC5 0x03 0x0c 0x1f 0x62 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 6a 86 == SW_INCORRECT_P1P2

// Complete Parameter Update: CAD ID 0x11223344; Set ExpDate 12/31/98
0x80 0x26 0x00 0x00 0x15 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC5 0x03 0x0c 0x1f 0x62 0x00 0x11 0x00 0x11 0x00 0x11 0x00 0x11 0x7F;
// 91 05 == SW_WRONG_SIGNATURE

// Complete Parameter Update: CAD ID 0x11223344; Set ExpDate 12/31/98
0x80 0x26 0x00 0x00 0x15 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xCF 0x03 0x0c 0x1f 0x62 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 6a 81 == SW_FUNC_NOT_SUPPORTED


// Complete Parameter Update: CAD ID 0x11223344; Set ExpDate 12/31/98
0x80 0x26 0x00 0x00 0x15 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC5 0x03 0x0c 0x1f 0x62 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 00 00 00 00 00 00 00 00 90 00;

// Complete Parameter Update: CAD ID 0x11223344; Set ExpDate 12/31/98
0x80 0x26 0x00 0x00 0x15 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC5 0x03 0x0c 0x1f 0x62 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 91 04 = SW_COMMAND_OUT_OF_SEQUENCE

// Initialize Parameter Update
0x80 0x24 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 00 0A 90 00 = Purse ID : 0x05050505; ExpDate 12/31/98; PUN 10

// Complete Parameter Update: CAD ID 0x11223344; Set Max Transaction $200.00;
0x80 0x26 0x00 0x00 0x14 0x11 0x22 0x33 0x44 0x00 0x00 0x00 0x00 0xC8 0x02 0x4E 0x20 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F;
// 00 00 00 00 00 00 00 00 90 00;

// Select JavaPurse
0x00 0xa4 0x04 0x00 10 0xa0 0 0 0 0x62 3 1 0xc 2 1 127;
// 90 00 = SW_NO_ERROR

// Verify PIN (User PIN 01020304)
0x00 0x20 0x00 0x82 0x04 0x01 0x02 0x03 0x04 0x00;
// 90 00;

// Initialize transaction: Debit $199.99
0x80 0x20 0x02 0x00 0x0a 0x4E 0x1F 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x7F;
// 91 02 == SW_NOT_ENOUGH_FUNDS

// Initialize transaction: Debit $192.19
0x80 0x20 0x02 0x00 0x0a 0x4b 0x13 0x33 0x44 0x55 0x66 0x00 0x00 0x00 0x00 0x7F;
// 05 05 05 05 0c 1f 62 4b 13 00 05 00 00 00 00 00 00 00 00 90 00;

// Complete Transaction: Date 10/28/97; Time 18:53
0x80 0x22 0x00 0x00 0x0d 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x0a 0x1c 0x61 0x12 0x35 0x7F;
// 00 00 00 00 00 00 00 00 00 00 90 00 = Balance = $0;

// Select JavaLoyalty (AID = "Loyalty")
0x00 0xa4 0x04 0x00 10 0xa0 0 0 0 0x62 3 1 0xc 5 1 127;
// 90 00 = SW_NO_ERROR

// Read Balance
0x90 0x20 0x00 0x00 0x00 0x00;
// 00 16 90 00 = Balance=22 points

// Reset Balance
0x90 0x22 0x00 0x00 0x00 0x00;
// 90 00 = SW_NO_ERROR

/////////////////////////////////////////////////////////////////////
// Initialize Wallet
/////////////////////////////////////////////////////////////////////

//Select Wallet
0x00 0xA4 0x04 0x00 0x0a 0xa0 0x0 0x0 0x0 0x62 0x3 0x1 0xc 0x6 0x1 0x7F;
// 90 00 = SW_NO_ERROR

//Verify user pin
0xB0 0x20 0x00 0x00 0x05 0x01 0x02 0x03 0x04 0x05 0x7F;
//90 00 = SW_NO_ERROR

//Get wallet balance
0xB0 0x50 0x00 0x00 0x00 0x02;
//0x00 0x00 0x00 0x00 0x90 0x00 = Balance = 0 and SW_ON_ERROR

//Attemp to debit from an empty account
0xB0 0x40 0x00 0x00 0x01 0x64 0x7F; 
//0x6A85 = SW_NEGATIVE_BALANCE

//Credit $100 to the empty account
0xB0 0x30 0x00 0x00 0x01 0x64 0x7F; 
//0x9000 = SW_NO_ERROR

//Get Balance
0xB0 0x50 0x00 0x00 0x00 0x02;
//0x00 0x64 0x9000 = Balance = 100 and SW_NO_ERROR

//Debit $50 from the account
0xB0 0x40 0x00 0x00 0x01 0x32 0x7F; 
//0x9000 = SW_NO_ERROR

//Get Balance
0xB0 0x50 0x00 0x00 0x00 0x02;
//0x00 0x32 0x9000 = Balance = 50 and SW_NO_ERROR

//Credit $128 to the account
0xB0 0x30 0x00 0x00 0x01 0x80 0x7F; 
//0x6A83 = SW_INVALID_TRANSACTION_AMOUNT

//Get Balance
0xB0 0x50 0x00 0x00 0x00 0x02;
//0x00 0x32 0x9000 = Balance = 50 and SW_NO_ERROR

//Debit $51 from the account
0xB0 0x40 0x00 0x00 0x01 0x33 0x7F;
//0x6A85 = SW_NEGATIVE_BALANC

//Get Balance
0xB0 0x50 0x00 0x00 0x00 0x02;
//0x00 0x32 0x9000 = Balance = 50 and SW_NO_ERROR

//Debit $128 from the account
0xB0 0x40 0x00 0x00 0x01 0x80 0x7F;
//0x6A83 = SW_INVALID_TRANSACTION_AMOUNT

//Get Balance
0xB0 0x50 0x00 0x00 0x00 0x02;
//0x00 0x32 0x9000 = Balance = 50 and SW_NO_ERROR

//Reselect Wallet applet so that userpin is reset
0x00 0xA4 0x04 0x00 0x0a 0xa0 0x0 0x0 0x0 0x62 0x3 0x1 0xc 0x6 0x1 0x7F;
// 90 00 = SW_NO_ERROR

//Credit $127 to the account before pin verification
0xB0 0x30 0x00 0x00 0x01 0x7F 0x7F;
//0x6301 = SW_PIN_VERIFICATION_REQUIRED

//Verify User pin with wrong pin value
0xB0 0x20 0x00 0x00 0x04 0x01 0x03 0x02 0x66 0x7F;
//0x6300 = SW_VERIFICATION_FAILED

//Verify user pin again with correct pin value 
//0xB0 0x20 0x00 0x00 0x08 0xF2 0x34 0x12 0x34 0x56 0x10 0x01 0x01 0x7F;
0xB0 0x20 0x00 0x00 0x05 0x01 0x02 0x03 0x04 0x05 0x7F;
//0x9000 = SW_NO_ERROR

//Get balance with incorrrect LE value 
0xB0 0x50 0x00 0x00 0x00 0x01;
//0x6700 = ISO7816.SW_WRONG_LENGTH

//Get balance 
0xB0 0x50 0x00 0x00 0x00 0x02;
//0x00 0x32 0x9000 = Balance = 50 and SW_NO_ERROR

// *** SCRIPT END ***
powerdown;
